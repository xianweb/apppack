(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{108:function(a,t,s){"use strict";s.r(t);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"electron应用打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#electron应用打包","aria-hidden":"true"}},[a._v("#")]),a._v(" Electron应用打包")]),s("h2",{attrs:{id:"概要"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概要","aria-hidden":"true"}},[a._v("#")]),a._v(" 概要")]),s("p",[a._v("为舒缓"),s("code",[a._v("Windows")]),a._v("下路径名过长的问题，也略对"),s("code",[a._v("require")]),a._v(" 加速以及"),s("strong",[a._v("简单隐匿你的源代码")]),a._v("，你可以通过极小的源代码改动将你的应用打包成 "),s("code",[a._v("asar")]),a._v("。")]),s("h2",{attrs:{id:"生成-asar-包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成-asar-包","aria-hidden":"true"}},[a._v("#")]),a._v(" 生成 asar 包")]),s("p",[s("code",[a._v("asar")]),a._v(" 是一种将多个文件合并成一个文件的类 tar 风格的归档格式。"),s("code",[a._v("Electron")]),a._v(" 可以无需解压，即从其中读取任意文件内容。")]),s("p",[a._v("参照如下步骤将你的应用打包成 "),s("code",[a._v("asar")]),a._v("：")]),s("h3",{attrs:{id:"_1-安装-asar"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-asar","aria-hidden":"true"}},[a._v("#")]),a._v(" 1. 安装 "),s("code",[a._v("asar")])]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ npm install -g asar\n")])]),s("h3",{attrs:{id:"_2-用-asar-pack-打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-用-asar-pack-打包","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 用 "),s("code",[a._v("asar pack")]),a._v(" 打包")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ asar pack your-app app.asar\n")])]),s("h3",{attrs:{id:"_3-使用-asar-包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-asar-包","aria-hidden":"true"}},[a._v("#")]),a._v(" 3. 使用 asar 包")]),s("p",[a._v("在 "),s("code",[a._v("Electron")]),a._v(" 中有两类 APIs：Node.js 提供的 "),s("code",[a._v("Node API")]),a._v(" 和 "),s("code",[a._v("Chromium")]),a._v(" 提供的 "),s("code",[a._v("Web API")]),a._v("。这两种 "),s("code",[a._v("API")]),a._v(" 都支持从 "),s("code",[a._v("asar")]),a._v(" 包中读取文件。")]),s("h4",{attrs:{id:"node-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-api","aria-hidden":"true"}},[a._v("#")]),a._v(" Node API")]),s("p",[a._v("由于 "),s("code",[a._v("Electron")]),a._v(" 中打了特别补丁， "),s("code",[a._v("Node API")]),a._v(" 中如 "),s("code",[a._v("fs.readFile")]),a._v(" 或者 "),s("code",[a._v("require")]),a._v(" 之类的方法可以将 "),s("code",[a._v("asar")]),a._v(" 视之为虚拟文件夹，读取 "),s("code",[a._v("asar")]),a._v(" 里面的文件就和从真实的文件系统中读取一样。")]),s("p",[a._v("例如，假设我们在 "),s("code",[a._v("/path/to")]),a._v(" 文件夹下有个 "),s("code",[a._v("example.asar")]),a._v(" 包：")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("$ asar list /path/to/example.asar\n/app.js\n/file.txt\n/dir/module.js\n/static/index.html\n/static/main.css\n/static/jquery.min.js\n")])]),s("p",[a._v("从 "),s("code",[a._v("asar")]),a._v(" 包读取一个文件：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[a._v("const")]),a._v(" fs "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token function"}},[a._v("require")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'fs'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nfs"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("readFileSync")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'/path/to/example.asar/file.txt'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),s("p",[a._v("列出 "),s("code",[a._v("asar")]),a._v(" 包中根目录下的所有文件：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[a._v("const")]),a._v(" fs "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token function"}},[a._v("require")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'fs'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nfs"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("readdirSync")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'/path/to/example.asar'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),s("p",[a._v("使用 "),s("code",[a._v("asar")]),a._v(" 包中的一个模块：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token function"}},[a._v("require")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'/path/to/example.asar/dir/module.js'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),s("p",[a._v("你也可以使用 "),s("code",[a._v("BrowserWindow")]),a._v(" 来显示一个 "),s("code",[a._v("asar")]),a._v(" 包里的 "),s("code",[a._v("web")]),a._v(" 页面：")]),s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[a._v("const")]),a._v(" BrowserWindow "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token function"}},[a._v("require")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'electron'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),a._v("BrowserWindow"),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{attrs:{class:"token keyword"}},[a._v("var")]),a._v(" win "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{attrs:{class:"token class-name"}},[a._v("BrowserWindow")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("width"),s("span",{attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{attrs:{class:"token number"}},[a._v("800")]),s("span",{attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" height"),s("span",{attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{attrs:{class:"token number"}},[a._v("600")]),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nwin"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("loadURL")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'file:///path/to/example.asar/static/index.html'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),s("h4",{attrs:{id:"web-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#web-api","aria-hidden":"true"}},[a._v("#")]),a._v(" Web API")]),s("p",[a._v("在 "),s("code",[a._v("Web")]),a._v(" 页面里，用 "),s("code",[a._v("file:")]),a._v(" 协议可以获取 "),s("code",[a._v("asar")]),a._v(" 包中文件。和 "),s("code",[a._v("Node API")]),a._v(" 一样，视 "),s("code",[a._v("asar")]),a._v(" 包如虚拟文件夹。")]),s("p",[a._v("例如，用 "),s("code",[a._v("$.get")]),a._v(" 获取文件:")]),s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[a._v("<")]),a._v("script")]),s("span",{attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{attrs:{class:"token script language-javascript"}},[a._v("\n"),s("span",{attrs:{class:"token keyword"}},[a._v("var")]),a._v(" $ "),s("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{attrs:{class:"token function"}},[a._v("require")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'./jquery.min.js'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n$"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token keyword"}},[a._v("get")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{attrs:{class:"token string"}},[a._v("'file:///path/to/example.asar/file.txt'")]),s("span",{attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{attrs:{class:"token keyword"}},[a._v("function")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("data"),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  console"),s("span",{attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{attrs:{class:"token function"}},[a._v("log")]),s("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("data"),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[a._v("</")]),a._v("script")]),s("span",{attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),s("h2",{attrs:{id:"node-api-缺陷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node-api-缺陷","aria-hidden":"true"}},[a._v("#")]),a._v(" Node API 缺陷")]),s("p",[a._v("尽管我们已经尽了最大努力使得 "),s("code",[a._v("asar")]),a._v(" 包在 "),s("code",[a._v("Node API")]),a._v(" 下的应用尽可能的趋向于真实的目录结构，但仍有一些底层 "),s("code",[a._v("Node API")]),a._v(" 我们无法保证其正常工作。")]),s("ul",[s("li",[s("p",[s("code",[a._v("asar")]),a._v(" 包是只读的")])]),s("li",[s("p",[s("code",[a._v("asar")]),a._v(" 包中的内容不可更改，所以 Node APIs 里那些可以用来修改文件的方法在对\n"),s("code",[a._v("asar")]),a._v(" 包时都无法正常工作。")])])])])}],!1,null,null,null);t.default=e.exports}}]);